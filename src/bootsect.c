/**
 * Boot sector routines
 */

#include <6502.h>
#include <atari.h>
#include <_atarios.h>
#include <string.h>
#include "bootsect.h"

const unsigned char bootsect[128] =
  {
   0x00, 0x01, 0x00, 0x07, 0x00, 0x07, 0xa9, 0x9a, 0x8d, 0xc4, 0x02, 0xa9,
   0x45, 0x8d, 0xc8, 0x02, 0xa9, 0x31, 0x8d, 0x30, 0x02, 0xa9, 0x07, 0x8d,
   0x31, 0x02, 0x4c, 0x1a, 0x07, 0x00, 0x2e, 0x29, 0x2e, 0x21, 0x07, 0x33,
   0x00, 0x24, 0x29, 0x21, 0x32, 0x39, 0x00, 0x24, 0x29, 0x33, 0x2b, 0x00,
   0x00, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70,
   0x70, 0x47, 0x1d, 0x07, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
  };

void bootsect_write(unsigned char drive_num)
{
  struct regs r;
  unsigned char i;

  // Write boot sectors to disk
  OS.dcb.ddevic=0x30; // Disk drive
  OS.dcb.dunit=drive_num;
  OS.dcb.dcomnd='P'; // Write, no verify
  OS.dcb.dtimlo=0x0F; // Default timeout
  OS.dcb.dstats=0x80; // Write
  OS.dcb.daux=1;
  OS.dcb.dbuf=&bootsect;
  r.pc=0xE453;
  _sys(&r);  
}

